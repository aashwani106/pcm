{
  "info": {
    "_postman_id": "d6d47c6c-36a1-4d15-b6ba-9074884510f8",
    "name": "PCM V2 Backend API",
    "description": "Postman collection for PCM V2 backend APIs (admin, student, parent).\n\nSetup:\n1. Set collection variables: baseUrl, adminToken, studentToken, parentToken.\n2. Start with Health + Admin > Get Students to auto-capture studentId.\n3. Use role-specific requests with matching token variables.",
    "schema": "https://schema.getpostman.com/json/collection/v2.1.0/collection.json"
  },
  "item": [
    {
      "name": "Health",
      "item": [
        {
          "name": "GET /health",
          "request": {
            "method": "GET",
            "header": [],
            "url": {
              "raw": "{{baseUrl}}/health",
              "host": [
                "{{baseUrl}}"
              ],
              "path": [
                "health"
              ]
            },
            "description": "Service health check"
          }
        }
      ]
    },
    {
      "name": "Users (Admin/Auth)",
      "item": [
        {
          "name": "GET /api/users?limit=20",
          "request": {
            "method": "GET",
            "header": [
              {
                "key": "Authorization",
                "value": "Bearer {{adminToken}}"
              }
            ],
            "url": {
              "raw": "{{baseUrl}}/api/users?limit=20",
              "host": [
                "{{baseUrl}}"
              ],
              "path": [
                "api",
                "users"
              ],
              "query": [
                {
                  "key": "limit",
                  "value": "20"
                }
              ]
            }
          }
        },
        {
          "name": "POST /api/users (Create Parent)",
          "request": {
            "method": "POST",
            "header": [
              {
                "key": "Authorization",
                "value": "Bearer {{adminToken}}"
              },
              {
                "key": "Content-Type",
                "value": "application/json"
              }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\n  \"email\": \"parent+{{timestamp}}@example.com\",\n  \"role\": \"parent\"\n}"
            },
            "url": {
              "raw": "{{baseUrl}}/api/users",
              "host": [
                "{{baseUrl}}"
              ],
              "path": [
                "api",
                "users"
              ]
            },
            "description": "Creates managed parent account and returns temporary password once."
          },
          "event": [
            {
              "listen": "test",
              "script": {
                "type": "text/javascript",
                "exec": [
                  "try {",
                  "  const json = pm.response.json();",
                  "  const userId = json?.data?.user_id;",
                  "  if (userId) pm.collectionVariables.set('parentUserId', userId);",
                  "} catch (e) {}"
                ]
              }
            }
          ]
        },
        {
          "name": "POST /api/users (Create Student)",
          "request": {
            "method": "POST",
            "header": [
              {
                "key": "Authorization",
                "value": "Bearer {{adminToken}}"
              },
              {
                "key": "Content-Type",
                "value": "application/json"
              }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\n  \"email\": \"student+{{timestamp}}@example.com\",\n  \"role\": \"student\",\n  \"batch\": \"Batch-A\",\n  \"parent_id\": \"{{parentUserId}}\"\n}"
            },
            "url": {
              "raw": "{{baseUrl}}/api/users",
              "host": [
                "{{baseUrl}}"
              ],
              "path": [
                "api",
                "users"
              ]
            },
            "description": "parent_id is mandatory for student creation."
          },
          "event": [
            {
              "listen": "test",
              "script": {
                "type": "text/javascript",
                "exec": [
                  "try {",
                  "  const json = pm.response.json();",
                  "  const studentId = json?.data?.student_id;",
                  "  if (studentId) pm.collectionVariables.set('studentId', studentId);",
                  "} catch (e) {}"
                ]
              }
            }
          ]
        },
        {
          "name": "POST /api/users/me/complete-password-change",
          "request": {
            "method": "POST",
            "header": [
              {
                "key": "Authorization",
                "value": "Bearer {{accessToken}}"
              }
            ],
            "url": {
              "raw": "{{baseUrl}}/api/users/me/complete-password-change",
              "host": [
                "{{baseUrl}}"
              ],
              "path": [
                "api",
                "users",
                "me",
                "complete-password-change"
              ]
            },
            "description": "Use with the currently logged-in user token after successful password update in Supabase Auth."
          }
        }
      ]
    },
    {
      "name": "Admin",
      "item": [
        {
          "name": "GET /admin/attendance?date=YYYY-MM-DD",
          "request": {
            "method": "GET",
            "header": [
              {
                "key": "Authorization",
                "value": "Bearer {{adminToken}}"
              }
            ],
            "url": {
              "raw": "{{baseUrl}}/admin/attendance?date={{date}}",
              "host": [
                "{{baseUrl}}"
              ],
              "path": [
                "admin",
                "attendance"
              ],
              "query": [
                {
                  "key": "date",
                  "value": "{{date}}"
                }
              ]
            }
          }
        },
        {
          "name": "GET /admin/students",
          "request": {
            "method": "GET",
            "header": [
              {
                "key": "Authorization",
                "value": "Bearer {{adminToken}}"
              }
            ],
            "url": {
              "raw": "{{baseUrl}}/admin/students",
              "host": [
                "{{baseUrl}}"
              ],
              "path": [
                "admin",
                "students"
              ]
            }
          },
          "event": [
            {
              "listen": "test",
              "script": {
                "type": "text/javascript",
                "exec": [
                  "try {",
                  "  const json = pm.response.json();",
                  "  const first = json?.data?.[0];",
                  "  if (first?.student_id) pm.collectionVariables.set('studentId', first.student_id);",
                  "} catch (e) {}"
                ]
              }
            }
          ]
        },
        {
          "name": "GET /admin/students/:studentId",
          "request": {
            "method": "GET",
            "header": [
              {
                "key": "Authorization",
                "value": "Bearer {{adminToken}}"
              }
            ],
            "url": {
              "raw": "{{baseUrl}}/admin/students/{{studentId}}",
              "host": [
                "{{baseUrl}}"
              ],
              "path": [
                "admin",
                "students",
                "{{studentId}}"
              ]
            }
          }
        },
        {
          "name": "PATCH /admin/students/:studentId",
          "request": {
            "method": "PATCH",
            "header": [
              {
                "key": "Authorization",
                "value": "Bearer {{adminToken}}"
              },
              {
                "key": "Content-Type",
                "value": "application/json"
              }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\n  \"full_name\": \"Student Demo\",\n  \"class_level\": \"10\",\n  \"batch_id\": \"Batch-A\",\n  \"roll_number\": \"R-101\",\n  \"status\": \"active\",\n  \"attendance_enabled\": true,\n  \"remark\": \"Updated from Postman\",\n  \"parent_name\": \"Parent Demo\",\n  \"parent_phone\": \"9999999999\",\n  \"parent_email\": \"parent.demo@example.com\"\n}"
            },
            "url": {
              "raw": "{{baseUrl}}/admin/students/{{studentId}}",
              "host": [
                "{{baseUrl}}"
              ],
              "path": [
                "admin",
                "students",
                "{{studentId}}"
              ]
            }
          }
        },
        {
          "name": "POST /admin/attendance/manual",
          "request": {
            "method": "POST",
            "header": [
              {
                "key": "Authorization",
                "value": "Bearer {{adminToken}}"
              },
              {
                "key": "Content-Type",
                "value": "application/json"
              }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\n  \"student_id\": \"{{studentId}}\",\n  \"status\": \"absent\",\n  \"remark\": \"Manual correction by admin\",\n  \"date\": \"{{date}}\"\n}"
            },
            "url": {
              "raw": "{{baseUrl}}/admin/attendance/manual",
              "host": [
                "{{baseUrl}}"
              ],
              "path": [
                "admin",
                "attendance",
                "manual"
              ]
            }
          }
        },
        {
          "name": "GET /admin/students/:studentId/attendance-calendar",
          "request": {
            "method": "GET",
            "header": [
              {
                "key": "Authorization",
                "value": "Bearer {{adminToken}}"
              }
            ],
            "url": {
              "raw": "{{baseUrl}}/admin/students/{{studentId}}/attendance-calendar?month={{month}}",
              "host": [
                "{{baseUrl}}"
              ],
              "path": [
                "admin",
                "students",
                "{{studentId}}",
                "attendance-calendar"
              ],
              "query": [
                {
                  "key": "month",
                  "value": "{{month}}"
                }
              ]
            }
          },
          "event": [
            {
              "listen": "test",
              "script": {
                "type": "text/javascript",
                "exec": [
                  "try {",
                  "  const json = pm.response.json();",
                  "  const map = json?.data?.attendance_by_date || {};",
                  "  const keys = Object.keys(map);",
                  "  for (let i = 0; i < keys.length; i += 1) {",
                  "    const row = map[keys[i]];",
                  "    if (row?.attendance_id) {",
                  "      pm.collectionVariables.set('attendanceId', row.attendance_id);",
                  "      break;",
                  "    }",
                  "  }",
                  "} catch (e) {}"
                ]
              }
            }
          ]
        },
        {
          "name": "GET /admin/students/:studentId/attendance-history",
          "request": {
            "method": "GET",
            "header": [
              {
                "key": "Authorization",
                "value": "Bearer {{adminToken}}"
              }
            ],
            "url": {
              "raw": "{{baseUrl}}/admin/students/{{studentId}}/attendance-history?date={{date}}",
              "host": [
                "{{baseUrl}}"
              ],
              "path": [
                "admin",
                "students",
                "{{studentId}}",
                "attendance-history"
              ],
              "query": [
                {
                  "key": "date",
                  "value": "{{date}}"
                }
              ]
            }
          }
        }
      ]
    },
    {
      "name": "Attendance",
      "item": [
        {
          "name": "GET /attendance/state (Student)",
          "request": {
            "method": "GET",
            "header": [
              {
                "key": "Authorization",
                "value": "Bearer {{studentToken}}"
              }
            ],
            "url": {
              "raw": "{{baseUrl}}/attendance/state",
              "host": [
                "{{baseUrl}}"
              ],
              "path": [
                "attendance",
                "state"
              ]
            }
          }
        },
        {
          "name": "POST /attendance/photo-upload-url (Student)",
          "request": {
            "method": "POST",
            "header": [
              {
                "key": "Authorization",
                "value": "Bearer {{studentToken}}"
              },
              {
                "key": "Content-Type",
                "value": "application/json"
              }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\n  \"mimeType\": \"image/jpeg\"\n}"
            },
            "url": {
              "raw": "{{baseUrl}}/attendance/photo-upload-url",
              "host": [
                "{{baseUrl}}"
              ],
              "path": [
                "attendance",
                "photo-upload-url"
              ]
            }
          },
          "event": [
            {
              "listen": "test",
              "script": {
                "type": "text/javascript",
                "exec": [
                  "try {",
                  "  const json = pm.response.json();",
                  "  if (json?.data?.photoUrl) pm.collectionVariables.set('photoUrl', json.data.photoUrl);",
                  "  if (json?.data?.uploadUrl) pm.collectionVariables.set('uploadUrl', json.data.uploadUrl);",
                  "} catch (e) {}"
                ]
              }
            }
          ]
        },
        {
          "name": "POST /attendance/mark (Student)",
          "request": {
            "method": "POST",
            "header": [
              {
                "key": "Authorization",
                "value": "Bearer {{studentToken}}"
              },
              {
                "key": "Content-Type",
                "value": "application/json"
              }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\n  \"photoUrl\": \"{{photoUrl}}\",\n  \"accuracyMeters\": 12.4\n}"
            },
            "url": {
              "raw": "{{baseUrl}}/attendance/mark",
              "host": [
                "{{baseUrl}}"
              ],
              "path": [
                "attendance",
                "mark"
              ]
            }
          },
          "event": [
            {
              "listen": "test",
              "script": {
                "type": "text/javascript",
                "exec": [
                  "try {",
                  "  const json = pm.response.json();",
                  "  const attendanceId = json?.data?.attendanceId;",
                  "  if (attendanceId) pm.collectionVariables.set('attendanceId', attendanceId);",
                  "} catch (e) {}"
                ]
              }
            }
          ]
        },
        {
          "name": "POST /attendance/review (Admin)",
          "request": {
            "method": "POST",
            "header": [
              {
                "key": "Authorization",
                "value": "Bearer {{adminToken}}"
              },
              {
                "key": "Content-Type",
                "value": "application/json"
              }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\n  \"attendance_id\": \"{{attendanceId}}\",\n  \"review_status\": \"accepted\",\n  \"review_note\": \"Looks valid\"\n}"
            },
            "url": {
              "raw": "{{baseUrl}}/attendance/review",
              "host": [
                "{{baseUrl}}"
              ],
              "path": [
                "attendance",
                "review"
              ]
            }
          }
        },
        {
          "name": "POST /attendance/review (Parent)",
          "request": {
            "method": "POST",
            "header": [
              {
                "key": "Authorization",
                "value": "Bearer {{parentToken}}"
              },
              {
                "key": "Content-Type",
                "value": "application/json"
              }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\n  \"attendance_id\": \"{{attendanceId}}\",\n  \"review_status\": \"flagged\",\n  \"review_note\": \"Need manual verification\"\n}"
            },
            "url": {
              "raw": "{{baseUrl}}/attendance/review",
              "host": [
                "{{baseUrl}}"
              ],
              "path": [
                "attendance",
                "review"
              ]
            }
          }
        },
        {
          "name": "GET /attendance/:attendanceId/photo-view-url (Student)",
          "request": {
            "method": "GET",
            "header": [
              {
                "key": "Authorization",
                "value": "Bearer {{studentToken}}"
              }
            ],
            "url": {
              "raw": "{{baseUrl}}/attendance/{{attendanceId}}/photo-view-url",
              "host": [
                "{{baseUrl}}"
              ],
              "path": [
                "attendance",
                "{{attendanceId}}",
                "photo-view-url"
              ]
            }
          }
        }
      ]
    },
    {
      "name": "Calendar",
      "item": [
        {
          "name": "GET /calendar/student?month=YYYY-MM",
          "request": {
            "method": "GET",
            "header": [
              {
                "key": "Authorization",
                "value": "Bearer {{studentToken}}"
              }
            ],
            "url": {
              "raw": "{{baseUrl}}/calendar/student?month={{month}}",
              "host": [
                "{{baseUrl}}"
              ],
              "path": [
                "calendar",
                "student"
              ],
              "query": [
                {
                  "key": "month",
                  "value": "{{month}}"
                }
              ]
            }
          }
        },
        {
          "name": "GET /calendar/parent?month=YYYY-MM",
          "request": {
            "method": "GET",
            "header": [
              {
                "key": "Authorization",
                "value": "Bearer {{parentToken}}"
              }
            ],
            "url": {
              "raw": "{{baseUrl}}/calendar/parent?month={{month}}",
              "host": [
                "{{baseUrl}}"
              ],
              "path": [
                "calendar",
                "parent"
              ],
              "query": [
                {
                  "key": "month",
                  "value": "{{month}}"
                }
              ]
            }
          }
        },
        {
          "name": "GET /calendar/parent?month=YYYY-MM&student_id=...",
          "request": {
            "method": "GET",
            "header": [
              {
                "key": "Authorization",
                "value": "Bearer {{parentToken}}"
              }
            ],
            "url": {
              "raw": "{{baseUrl}}/calendar/parent?month={{month}}&student_id={{studentId}}",
              "host": [
                "{{baseUrl}}"
              ],
              "path": [
                "calendar",
                "parent"
              ],
              "query": [
                {
                  "key": "month",
                  "value": "{{month}}"
                },
                {
                  "key": "student_id",
                  "value": "{{studentId}}"
                }
              ]
            }
          }
        }
      ]
    },
    {
      "name": "Notifications",
      "item": [
        {
          "name": "POST /notifications/admin/absent/run?date=YYYY-MM-DD",
          "request": {
            "method": "POST",
            "header": [
              {
                "key": "Authorization",
                "value": "Bearer {{adminToken}}"
              }
            ],
            "url": {
              "raw": "{{baseUrl}}/notifications/admin/absent/run?date={{date}}",
              "host": [
                "{{baseUrl}}"
              ],
              "path": [
                "notifications",
                "admin",
                "absent",
                "run"
              ],
              "query": [
                {
                  "key": "date",
                  "value": "{{date}}"
                }
              ]
            }
          }
        },
        {
          "name": "GET /notifications/parent?limit=20",
          "request": {
            "method": "GET",
            "header": [
              {
                "key": "Authorization",
                "value": "Bearer {{parentToken}}"
              }
            ],
            "url": {
              "raw": "{{baseUrl}}/notifications/parent?limit=20",
              "host": [
                "{{baseUrl}}"
              ],
              "path": [
                "notifications",
                "parent"
              ],
              "query": [
                {
                  "key": "limit",
                  "value": "20"
                }
              ]
            }
          },
          "event": [
            {
              "listen": "test",
              "script": {
                "type": "text/javascript",
                "exec": [
                  "try {",
                  "  const json = pm.response.json();",
                  "  const first = json?.data?.[0];",
                  "  if (first?.id) pm.collectionVariables.set('notificationId', first.id);",
                  "} catch (e) {}"
                ]
              }
            }
          ]
        },
        {
          "name": "PATCH /notifications/parent/:id/read",
          "request": {
            "method": "PATCH",
            "header": [
              {
                "key": "Authorization",
                "value": "Bearer {{parentToken}}"
              }
            ],
            "url": {
              "raw": "{{baseUrl}}/notifications/parent/{{notificationId}}/read",
              "host": [
                "{{baseUrl}}"
              ],
              "path": [
                "notifications",
                "parent",
                "{{notificationId}}",
                "read"
              ]
            }
          }
        }
      ]
    }
  ],
  "variable": [
    {
      "key": "baseUrl",
      "value": "http://localhost:4000"
    },
    {
      "key": "adminToken",
      "value": ""
    },
    {
      "key": "studentToken",
      "value": ""
    },
    {
      "key": "parentToken",
      "value": ""
    },
    {
      "key": "accessToken",
      "value": ""
    },
    {
      "key": "studentId",
      "value": ""
    },
    {
      "key": "parentUserId",
      "value": ""
    },
    {
      "key": "attendanceId",
      "value": ""
    },
    {
      "key": "notificationId",
      "value": ""
    },
    {
      "key": "photoUrl",
      "value": "attendance-photos/student-id/example.jpg"
    },
    {
      "key": "uploadUrl",
      "value": ""
    },
    {
      "key": "date",
      "value": "2026-02-11"
    },
    {
      "key": "month",
      "value": "2026-02"
    },
    {
      "key": "timestamp",
      "value": "1700000000"
    }
  ]
}
